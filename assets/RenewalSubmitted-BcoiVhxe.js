import{r as x,j as e,a as de}from"./react-DyBbpTfo.js";import{T as ce,i as O,G as d,B as me,a as p,k as L,l as w,V as ue,j as he,I as xe,W as pe,M as b,t as be,v as fe,w as je,x as y,y as o,z as ge,c as z,X as B,g as f,a2 as P,R as Se,H as ve,J as _e,K as we,N as ye,S as E,A as W}from"./@mui-BieppYyU.js";import{L as Re,S as Ce,a as Te,b as Ae}from"./Layout-BTsGQOv-.js";import{t as $e}from"./theme-D40dVDi4.js";import{a as Ne,b as R}from"./index-CLUh4Q3Z.js";import"./classnames-BKHECdoj.js";import{u as Ye}from"./LoaderAnimation-CH_DHjss.js";import{u as ke}from"./SubmissionStore-Ceg7ZcXh.js";import{u as Fe,C as V}from"./react-hook-form-BLdPXlwC.js";import{a as Ie}from"./react-router-Cd-RU2wi.js";import"./@babel-8cBiVioP.js";import"./clsx-B-dksMZM.js";import"./@emotion-C_NMWrO_.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-BqmD5Vow.js";import"./react-transition-group-es_vqKy0.js";import"./react-dom-BKrvlAQh.js";import"./scheduler-CzFDRTuY.js";import"./@react-spring-V1f4ptoc.js";import"./d3-color-9lF95FHy.js";import"./d3-shape-D9lAmgB5.js";import"./d3-path-CimkQT29.js";import"./d3-scale-CFwq3Dxo.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-DJclFi1f.js";import"./d3-format-CzD4bSOQ.js";import"./d3-interpolate-lgBfS8Nc.js";import"./d3-time-format-DZUSPL1N.js";import"./d3-time-Dz5jZYzf.js";import"./@popperjs-BQBsAJpH.js";import"./react-router-dom-CzVCKb4Q.js";import"./@remix-run-B-RBrVrq.js";import"./UserStore-CIOHG4rb.js";import"./zustand-BzSMVJrz.js";import"./use-sync-external-store-C98n5-Y-.js";import"./axios-B4uVmeYG.js";function $s(){const D=Fe(),{register:Me,control:C,handleSubmit:Oe,formState:Le,reset:ze,watch:T,validate:Be,setValue:Pe,getValues:Ee}=D,{getAuthToken:j,alertOpen:G,alertMessage:H,setAlertOpen:c,setAlertMessage:g,errorOpen:J,setErrorOpen:i,setErrorMessage:l,errorMessage:U}=Ne(),{showPassword:We,handleTogglePassword:Ve,setLoading:S,setLoadingMessage:K}=Ye(),{renewalForms:m,setRenewalForms:X,renewalForm:De,selectedSubmission:Ge,setSelectedSubmission:q,setRenewalSubmission:Z,modalRenewal:Q,setModalRenewal:A,renewalIdToSend:ee,setRenewalIdToSend:$,filteredSubmission:v,setFilteredSubmission:se,searchQuery:u,handleSearch:re,setRenewalMap:te,setPassYear:oe,setPassTerm:ne}=ke(),[N,Y]=x.useState([]),h=Ie(),k=s=>{$(s),A(!0)},_=()=>{$(null),A(!1)},ae=()=>{const s=new Date().getMonth()+1,r=new Date().getFullYear(),t=s<4?r-1:r,n=t+1;return`${t}-${n}`};x.useEffect(()=>{const s=localStorage.getItem("schoolYears"),r=s?JSON.parse(s):[],t=ae();if(r.includes(t))Y(r);else{const n=[t,...r].slice(0,2);localStorage.setItem("schoolYears",JSON.stringify(n)),Y(n)}},[]),x.useEffect(()=>{(async()=>{try{console.log("Fetching renewal forms...");const r=j(),t=await R.get("/api/renewal-documents",{headers:{Authorization:`Bearer ${r}`}});t.status===200&&te(t.data.data)}catch(r){console.error("Error fetching renewal forms:",r),r.response&&r.response.status===401&&h("/login")}})()},[]);const F=T("term_submitted"),I=T("school_yr_submitted");x.useEffect(()=>{(async()=>{try{const r=j(),t=await R.get("/api/scholars",{headers:{Authorization:`Bearer ${r}`}});t.status===200?(X(t.data.data),c(!0),g("Renewal forms fetched successfully.")):(i(!0),l("Failed to fetch renewal forms."))}catch(r){r.response.status===401?h("/login"):(l("Unable to fetch renewal forms. Please try again."),i(!0))}})()},[]);const ie=async()=>{try{const s=j();if(!s){l("You are not authorized to perform this action. Please refresh browser");return}S(!0),K("Sending reminders..."),c(!0),g("Sending reminders...");const r=await R.put(`/api/send-reminders/${ee}`,null,{headers:{Authorization:`Bearer ${s}`}});r.status===200?(Z(r.data.data),g("Reminders sent successfully."),c(!0)):(l("Failed to send reminders."),i(!0)),S(!1),_()}catch(s){s.response.status===401?h("/login"):(l("Unable to send reminders. Please try again."),i(!0)),S(!1)}},M=(s,r,t)=>{const n=m.find(a=>a.id===s);n?(oe(r),ne(t),q(n),h("/renewal-view")):(i(!0),l("Failed to view submission."))};return e.jsx(Re,{children:e.jsx(ce,{theme:$e,children:e.jsxs(O,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,mb:4,children:e.jsxs(d,{item:!0,sx:{display:"flex",alignItems:"center"},gap:4,children:[e.jsx(me,{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"left",md:"center"},justifyContent:"space-between",children:e.jsx(p,{variant:"h1",id:"tabsTitle",sx:{color:"black"},children:"Renewal Submission"})}),e.jsxs(d,{id:"schoolYearGrid",children:[e.jsx(L,{htmlFor:"school_yr_submitted",id:"schoolYearLabel"}),e.jsx(V,{name:"school_yr_submitted",id:"school_yr_submitted",control:C,defaultValue:N[0],render:({field:s})=>e.jsxs(w,{native:!0,...s,sx:{border:"1px solid rgba(0,0,0,0.2)",boxShadow:"11px 7px 15px -3px rgba(0,0,0,0.1)",borderRadius:"15px",height:"50px"},children:[e.jsx("option",{value:"",children:"Select SY"}),N.map(r=>e.jsx("option",{value:r,children:`SY ${r}`},r))]})})]}),e.jsxs(d,{id:"termGrid",children:[e.jsx(L,{htmlFor:"term_submitted",id:"termLabel"}),e.jsx(V,{name:"term_submitted",id:"term_submitted",control:C,render:({field:s})=>e.jsxs(w,{native:!0,...s,sx:{border:"1px solid rgba(0,0,0,0.2)",boxShadow:"11px 7px 15px -3px rgba(0,0,0,0.1)",borderRadius:"15px",height:"50px"},children:[e.jsx("option",{value:"",children:"Select Term"}),e.jsx("option",{value:"Term 1",children:"Term 1"}),e.jsx("option",{value:"Term 2",children:"Term 2"}),e.jsx("option",{value:"Term 3",children:"Term 3"})]})})]})]})}),e.jsxs(d,{sx:{borderRadius:"8px",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",overflow:"auto",width:"100%"},children:[e.jsxs(O,{sx:{mt:4,mb:4,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(Ce,{children:[e.jsx(Te,{children:e.jsx(ue,{})}),e.jsx(Ae,{placeholder:"Search for names, groups, or email addresses",inputProps:{"aria-label":"search"},value:u,onChange:re})]}),e.jsx(he,{sx:{minWidth:120},children:e.jsxs(w,{value:v,onChange:s=>se(s.target.value),displayEmpty:!0,inputProps:{"aria-label":"Filter"},startAdornment:e.jsx(xe,{position:"start",children:e.jsx(pe,{viewBox:"0 0 24 24",sx:{width:20,height:20,color:"rgba(0, 0, 0, 0.54)"}})}),sx:{borderRadius:"12px"},children:[e.jsx(b,{value:"All",children:"All"}),e.jsx(b,{value:"For Approval",children:"For Approval"}),e.jsx(b,{value:"Approved",children:"Approved"}),e.jsx(b,{value:"For Resubmission",children:"For Resubmission"})]})})]}),e.jsxs(be,{sx:{backgroundColor:"#00000"},children:[e.jsxs(fe,{children:[e.jsx(je,{children:e.jsxs(y,{children:[e.jsx(o,{sx:{fontWeight:"bold",fontSize:"1rem"},children:"Scholar's Name"}),e.jsx(o,{sx:{fontWeight:"bold",fontSize:"1rem"},children:"Status"}),e.jsx(o,{sx:{fontWeight:"bold",fontSize:"1rem"},children:"View Submission"}),e.jsx(o,{sx:{fontWeight:"bold",fontSize:"1rem"},children:"Action"})]})}),e.jsx(ge,{children:m.filter(s=>v==="All"?!0:Object.values(s.renewing).some(r=>r.submission_status===v)).filter(s=>I===""?!0:Object.keys(s.renewing).some(r=>r===I)).filter(s=>`${s.user_first_name} ${s.user_middle_name||""} ${s.user_last_name}`.toLowerCase().includes(u==null?void 0:u.toLowerCase())).map((s,r)=>e.jsxs(de.Fragment,{children:[Object.entries(s.renewing).map(([t,n])=>n.filter(a=>a.term===F||F==="").map((a,le)=>e.jsxs(y,{className:"user",children:[e.jsx(o,{sx:{border:"none"},className:"name",children:`${s.user_first_name} ${s.user_middle_name||""} ${s.user_last_name}`}),e.jsx(o,{sx:{border:"none"},className:"submission_status",children:a.submission_status==="For Approval"?e.jsx("span",{className:"For_Approval",children:"For Approval"}):a.submission_status==="Approved"?e.jsx("span",{className:"Approved",children:"Approved"}):a.submission_status==="For Resubmission"?e.jsx("span",{className:"For_Resubmission",children:"For Resubmission"}):e.jsx("span",{className:"No_Submission",children:"No Submission"})}),e.jsx(o,{sx:{border:"none"},className:"role",children:e.jsx(z,{color:"inherit",onClick:()=>M(s.id,t,a.term),children:e.jsx(B,{sx:{transform:"rotate(90deg)",marginLeft:"2rem"}})})}),e.jsx(o,{sx:{border:"none",color:"#2684ff"},children:e.jsxs(f,{variant:"contained",onClick:()=>k(s.id),children:[e.jsx(P,{}),e.jsx(p,{variant:"h6",color:"white",children:"Send Reminders"})]})})]},`${r}-${a.term}-${le}`))),!Object.keys(s.renewing).length&&e.jsxs(y,{children:[e.jsx(o,{sx:{border:"none"},className:"name",children:`${s.user_first_name} ${s.user_middle_name||""} ${s.user_last_name}`}),e.jsx(o,{sx:{border:"none"},className:"submission_status",children:e.jsx("span",{className:"No_Submission",children:"No Submission"})}),e.jsx(o,{sx:{border:"none"},className:"role",children:e.jsx(z,{color:"inherit",onClick:()=>M(s.id),children:e.jsx(B,{sx:{transform:"rotate(90deg)",marginLeft:"2rem"}})})}),e.jsx(o,{sx:{border:"none",color:"#2684ff"},children:e.jsxs(f,{variant:"contained",onClick:()=>k(s.id),children:[e.jsx(P,{}),e.jsx(p,{variant:"h6",color:"white",children:"Send Reminders"})]})})]})]},r))})]}),e.jsx(Se,{sx:{width:"100%"}})]})]})]}),e.jsxs(ve,{open:Q,onClose:_,children:[e.jsx(_e,{id:"dialogTitle",mt:2,children:"Send Reminders"}),e.jsx(we,{children:e.jsxs(p,{variant:"h5",ml:1,sx:{color:"#44546F"},children:["You are about to send reminders to ",m.user_first_name," ",m.user_middle_name||""," ",m.user_last_name," for their renewal submission. Are you sure you want to proceed?"]})}),e.jsxs(ye,{children:[e.jsx(f,{color:"primary",onClick:_,children:"Cancel"}),e.jsx(f,{color:"primary",variant:"contained",sx:{borderRadius:"5px",mb:2,mt:2,backgroundColor:"#43a047","&:hover":{backgroundColor:"#43a047"}},onClick:ie,children:"Send Reminder"})]})]}),e.jsx(E,{open:G,autoHideDuration:5e3,onClose:()=>c(!1),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(W,{onClose:()=>c(!1),variant:"filled",severity:"success",sx:{width:"100%"},children:H})}),e.jsx(E,{open:J,autoHideDuration:5e3,onClose:()=>i(!1),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(W,{onClose:()=>i(!1),variant:"filled",severity:"error",sx:{width:"100%"},children:U})})]})})})}export{$s as default};
