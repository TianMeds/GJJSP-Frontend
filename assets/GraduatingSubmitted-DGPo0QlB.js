import{r as v,j as e,a as te}from"./react-DyBbpTfo.js";import{T as ae,i as T,G as c,B as oe,a as h,k as ie,l as N,V as ne,j as le,I as de,W as ce,M as p,t as ue,v as me,w as he,x as _,y as a,z as pe,c as I,X as O,g as x,a2 as G,R as xe,H as fe,J as je,K as be,N as ge,S as M,A as D}from"./@mui-BieppYyU.js";import{L as Se,S as ve,a as _e,b as ye}from"./Layout-BTsGQOv-.js";import{t as Ce}from"./theme-D40dVDi4.js";import{a as we,b as z}from"./index-CLUh4Q3Z.js";import{u as Ae}from"./LoaderAnimation-CH_DHjss.js";import{u as $e}from"./SubmissionStore-Ceg7ZcXh.js";import{u as Re,C as Ye}from"./react-hook-form-BLdPXlwC.js";import{a as ke}from"./react-router-Cd-RU2wi.js";import"./@babel-8cBiVioP.js";import"./clsx-B-dksMZM.js";import"./@emotion-C_NMWrO_.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-BqmD5Vow.js";import"./react-transition-group-es_vqKy0.js";import"./react-dom-BKrvlAQh.js";import"./scheduler-CzFDRTuY.js";import"./@react-spring-V1f4ptoc.js";import"./d3-color-9lF95FHy.js";import"./d3-shape-D9lAmgB5.js";import"./d3-path-CimkQT29.js";import"./d3-scale-CFwq3Dxo.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-DJclFi1f.js";import"./d3-format-CzD4bSOQ.js";import"./d3-interpolate-lgBfS8Nc.js";import"./d3-time-format-DZUSPL1N.js";import"./d3-time-Dz5jZYzf.js";import"./@popperjs-BQBsAJpH.js";import"./react-router-dom-CzVCKb4Q.js";import"./@remix-run-B-RBrVrq.js";import"./UserStore-CIOHG4rb.js";import"./zustand-BzSMVJrz.js";import"./use-sync-external-store-C98n5-Y-.js";import"./axios-B4uVmeYG.js";function vs(){const B=Re(),{register:Te,control:F,handleSubmit:Ne,formState:Ie,reset:Oe,watch:L,validate:Ge,setValue:Me}=B,f=ke(),{getAuthToken:y,alertOpen:W,alertMessage:E,setAlertOpen:n,setAlertMessage:j,errorOpen:P,setErrorOpen:i,setErrorMessage:l,errorMessage:V}=we(),{setLoading:C,setLoadingMessage:H}=Ae(),{graduatingForms:d,setGraduatingForms:J,modalGraduating:U,setModalGraduating:w,graduatingIdToSend:K,setGraduatingIdToSend:A,filteredSubmission:b,setFilteredSubmission:X,searchQuery:u,handleSearch:q,selectedSubmission:De,setSelectedSubmission:Z,passYear:ze,setPassYear:Q}=$e(),[$,R]=v.useState([]),Y=s=>{A(s),w(!0)},g=()=>{A(null),w(!1)},ee=()=>{const s=new Date().getMonth()+1,r=new Date().getFullYear(),t=s<4?r-1:r,o=t+1;return`${t}-${o}`};v.useEffect(()=>{const s=localStorage.getItem("schoolYears"),r=s?JSON.parse(s):[],t=ee();if(r.includes(t))R(r);else{const o=[t,...r].slice(0,10);localStorage.setItem("schoolYears",JSON.stringify(o)),R(o)}},[]),v.useEffect(()=>{(async()=>{try{const r=y(),t=await z.get("/api/scholars",{headers:{Authorization:`Bearer ${r}`}});t.status===200?(J(t.data.data),n(!0),j("Graduating forms fetched successfully.")):(i(!0),l("Failed to fetch graduating forms."))}catch(r){r.response.status===401?f("/login"):(l("Unable to fetch graduating forms. Please try again."),i(!0))}})()},[]);const se=async()=>{try{const s=y();C(!0),H("Sending reminders..."),n(!0),j("Sending Reminder."),(await z.put(`/api/graduating-reminders/${K}`,null,{headers:{Authorization:`Bearer ${s}`}})).status===200?(j("Reminder sent successfully."),n(!0)):(l("Failed to send reminder."),i(!0)),C(!1),g()}catch(s){s.response.status===401?f("/login"):(l("Unable to send reminder. Please try again."),i(!0))}},m=L("school_yr_submitted"),k=(s,r)=>{const t=d.find(o=>o.id===s);t?(Z(t),Q(r),f("/graduating-view")):(l("Unable to view submission. Please try again."),i(!0))};return e.jsx(Se,{children:e.jsx(ae,{theme:Ce,children:e.jsxs(T,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,children:e.jsxs(c,{item:!0,sx:{display:"flex",alignItems:"center"},gap:4,xs:12,children:[e.jsx(oe,{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"left",md:"center"},margin:2,justifyContent:"space-between",children:e.jsx(h,{variant:"h1",id:"tabsTitle",sx:{color:"black"},children:"Graduating Submission"})}),e.jsxs(c,{id:"schoolYearGrid",children:[e.jsx(ie,{htmlFor:"school_yr_submitted",id:"schoolYearLabel"}),e.jsx(Ye,{name:"school_yr_submitted",id:"school_yr_submitted",control:F,defaultValue:$[0],render:({field:s})=>e.jsxs(N,{native:!0,...s,sx:{border:"1px solid rgba(0,0,0,0.2)",boxShadow:"11px 7px 15px -3px rgba(0,0,0,0.1)",borderRadius:"15px",height:"50px"},children:[e.jsx("option",{value:"",children:"Select SY"}),$.map(r=>e.jsx("option",{value:r,children:`SY ${r}`},r))]})})]})]})}),e.jsx(c,{sx:{borderRadius:"8px",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",overflow:"auto",width:"100%"},children:e.jsxs(T,{sx:{mt:4,mb:4,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(ve,{children:[e.jsx(_e,{children:e.jsx(ne,{})}),e.jsx(ye,{placeholder:"Search for names, groups, or email addresses",inputProps:{"aria-label":"search"},value:u,onChange:q})]}),e.jsx(le,{sx:{minWidth:120},children:e.jsxs(N,{value:b,onChange:s=>X(s.target.value),displayEmpty:!0,inputProps:{"aria-label":"Filter"},startAdornment:e.jsx(de,{position:"start",children:e.jsx(ce,{viewBox:"0 0 24 24",sx:{width:20,height:20,color:"rgba(0, 0, 0, 0.54)"}})}),sx:{borderRadius:"12px"},children:[e.jsx(p,{value:"All",children:"All"}),e.jsx(p,{value:"For Approval",children:"For Approval"}),e.jsx(p,{value:"Approved",children:"Approved"}),e.jsx(p,{value:"For Resubmission",children:"For Resubmission"})]})})]})}),e.jsxs(ue,{sx:{backgroundColor:"#fbf3f2"},children:[e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(_,{children:[e.jsx(a,{sx:{fontWeight:"bold",fontSize:"1rem"},children:"Scholar's Name"}),e.jsx(a,{sx:{fontWeight:"bold",fontSize:"1rem"},children:"Status"}),e.jsx(a,{sx:{fontWeight:"bold",fontSize:"1rem"},children:"View Submission"}),e.jsx(a,{sx:{fontWeight:"bold",fontSize:"1rem"},children:"Action"})]})}),e.jsx(pe,{children:d.filter(s=>b==="All"?!0:Object.entries(s.graduating).some(([r,t])=>r===m&&t.some(o=>o.submission_status===b))).filter(s=>m===""?!0:Object.keys(s.graduating).some(r=>r===m)).filter(s=>`${s.user_first_name} ${s.user_middle_name||""} ${s.user_last_name}`.toLowerCase().includes(u==null?void 0:u.toLowerCase())).map((s,r)=>e.jsxs(te.Fragment,{children:[Object.entries(s.graduating).map(([t,o])=>m===t&&o.map((S,re)=>e.jsxs(_,{className:"user",children:[e.jsx(a,{children:`${s.user_first_name} ${s.user_middle_name||""} ${s.user_last_name}`}),e.jsx(a,{children:S.submission_status==="For Approval"?e.jsx("span",{className:"For_Approval",children:"For Approval"}):S.submission_status==="Approved"?e.jsx("span",{className:"Approved",children:"Approved"}):S.submission_status==="For Resubmission"?e.jsx("span",{className:"For_Resubmission",children:"For Resubmission"}):e.jsx("span",{className:"No_Submission",children:"No Submission"})}),e.jsx(a,{children:e.jsx(I,{color:"inherit",onClick:()=>k(s.id,t),children:e.jsx(O,{sx:{transform:"rotate(90deg)"}})})}),e.jsx(a,{sx:{color:"#2684ff"},children:e.jsxs(x,{variant:"contained",onClick:()=>Y(s.id),children:[e.jsx(G,{}),e.jsx(h,{variant:"h5",children:"Send Reminders"})]})})]},`${r}-${t}-${re}`))),Object.keys(s.graduating).length===0&&e.jsxs(_,{className:"user",children:[e.jsx(a,{children:`${s.user_first_name} ${s.user_middle_name||""} ${s.user_last_name}`}),e.jsx(a,{children:e.jsx("span",{className:"No_Submission",children:"No Submission"})}),e.jsx(a,{children:e.jsx(I,{color:"inherit",onClick:()=>k(s.id,schoolYear),children:e.jsx(O,{sx:{transform:"rotate(90deg)"}})})}),e.jsx(a,{sx:{color:"#2684ff"},children:e.jsxs(x,{variant:"contained",onClick:()=>Y(s.id),children:[e.jsx(G,{}),e.jsx(h,{variant:"h5",children:"Send Reminders"})]})})]},`${r}-no-submission`)]},r))})]}),e.jsx(xe,{sx:{width:"100%"}})]})]}),e.jsxs(fe,{open:U,onClose:g,children:[e.jsx(je,{id:"dialogTitle",mt:2,children:"Send Reminders"}),e.jsx(be,{children:e.jsxs(h,{variant:"h5",ml:1,sx:{color:"#44546F"},children:["You are about to send reminders to ",d.user_first_name," ",d.user_middle_name||""," ",d.user_last_name," for their graduating submission. Are you sure you want to proceed?"]})}),e.jsxs(ge,{children:[e.jsx(x,{color:"primary",onClick:g,children:"Cancel"}),e.jsx(x,{color:"primary",variant:"contained",sx:{borderRadius:"5px",mb:2,mt:2,backgroundColor:"#43a047","&:hover":{backgroundColor:"#43a047"}},onClick:se,children:"Send Reminder"})]})]}),e.jsx(M,{open:W,autoHideDuration:5e3,onClose:()=>n(!1),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(D,{onClose:()=>n(!1),variant:"filled",severity:"success",sx:{width:"100%"},children:E})}),e.jsx(M,{open:P,autoHideDuration:5e3,onClose:()=>i(!1),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(D,{onClose:()=>i(!1),variant:"filled",severity:"error",sx:{width:"100%"},children:V})})]})})})}export{vs as default};
